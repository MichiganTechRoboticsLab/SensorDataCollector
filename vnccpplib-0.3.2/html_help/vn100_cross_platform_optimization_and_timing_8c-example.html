<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>VectorNav C/C++ Library: vn100_cross_platform_optimization_and_timing.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">VectorNav C/C++ Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">vn100_cross_platform_optimization_and_timing.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>This examples shows how to create a cross-platform project that can run on either a Windows or Linux machines, and will also make sure that the COM port is optimized when run on a Windows machine.</p>
<h1><a class="anchor" id="runningVn100CrossPlatformOptimizationAndTimingOnWindows"></a>
Running the Example on Windows</h1>
<ol type="1">
<li>On your Windows machine, open the project <code>Vn100CrossPlatformComPortOptimizationAndTiming.vcxproj</code>, located in the directory <code>&lt;VectorNav C/C++ Library Root&gt;/examples/vn100_cross_platform_com_port_optimization_and_timing</code>.</li>
<li>Under the project listing in <code>Visual Studio</code>, open the file <code>Source Files/vn100_cross_platform_optimization_and_timing.c</code> and change the connection defines <code>PORT_NAME</code> and <code>BAUDRATE</code> to the settings of your VN-100 sensor.</li>
<li>Now, right-click the project and select the option <code>Build</code>. Make sure the project builds correctly and the text <code>Build succeeded</code> appears in the bottom-left of <code>Visual Studio</code>.</li>
<li>With the project now built, you can now run the program. However, since on some Windows platforms, administrator privileges will be required to optimize the COM port, it is recommended that you run the program from a command prompt. This will allow you to either open the command prompt as the current user, or run the command prompt as administrator.</li>
</ol>
<h1><a class="anchor" id="runningVn100CrossPlatformOptimizationAndTimingOnLinux"></a>
Running the Example on Linux</h1>
<ol type="1">
<li>On your Linux machine, open a terminal and change to the directory <code>&lt;VectorNav C/C++ Library Root&gt;/examples/vn100_cross_platform_com_port_optimization_and_timing</code>.</li>
<li>You will need to determine what port your sensor is connected to. Typically if you are connected to a physical COM port on your machine, this will typically be <code>/dev/ttyS1</code>. However, if you are connected using the USB cable, there will be a virtual COM port which will typically be identified as <code>/dev/ttyUSB0</code>. You can display which ports are available on the machine by executing the command <code>ls /dev</code>.</li>
<li>Open the file <code>vn100_cross_platform_optimization_and_timing.c</code> in the current directory and at the top, change the global variable <code>COM_PORT</code> to the port identified in the previous step. You may also have to change the variable <code>BAUD_RATE</code> if this has been change on the sensor from the factory default.</li>
<li>First make sure there are not any binaries or object files by executing the command <code>make clean</code>.</li>
<li>Compile the example by executing <code>make</code>.</li>
<li>You can now run the example program by executing <code>./vn100_cross_platform_com_port_optimization_and_timing</code>. Note on some distributions of Linux and depending on your system account privileges, you may have to sudo to run the program (i.e. <code>sudo ./vn100_cross_platform_com_port_optimization_and_timing</code>).</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#if defined(WIN32)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #include &lt;Windows.h&gt;</span></div>
<div class="line"><span class="preprocessor">    #include &lt;tchar.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="vectornav_8h.html">vectornav.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Change the connection settings to your configuration. */</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* PORT_NAME = <span class="stringliteral">&quot;//dev//ttyUSB0&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> BAUDRATE = 115200;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> asyncVn100DataListener(<span class="keywordtype">void</span>* sender, <a name="_a0"></a><a class="code" href="struct_vn_device_composite_data.html" title="Composite structure of the various asynchronous data VectorNav devices are capable of outputting...">VnDeviceCompositeData</a>* data);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(WIN32)</span></div>
<div class="line"><span class="preprocessor"></span><span class="keywordtype">int</span> _tmain(<span class="keywordtype">int</span> argc, _TCHAR* argv[])</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span><span class="keywordtype">int</span> main()</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>{</div>
<div class="line">    <a name="_a1"></a><a class="code" href="struct_vn100.html" title="Holds connection information for accessing a VN-100 device. ">Vn100</a> vn100;</div>
<div class="line">    <span class="keywordtype">int</span> errorCode;</div>
<div class="line">    <span class="keywordtype">bool</span> isOptimized;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Before attempting to connect to the VN-100 sensor, let&#39;s make sure the</span></div>
<div class="line"><span class="comment">       COM port is optimized. Optimization is only necessary on Windows</span></div>
<div class="line"><span class="comment">       machines that are connecting to the sensor using a USB cable. */</span></div>
<div class="line">    errorCode = vncp_comPort_isOptimized(</div>
<div class="line">        PORT_NAME, </div>
<div class="line">        &amp;isOptimized);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (errorCode != <a name="a2"></a><a class="code" href="group___v_n___e_r_r_o_r___c_o_d_e.html#ga375de3d5056cfee0551d6b345b67b3ff">VNERR_NO_ERROR</a>)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error received when trying to determine if the COM port is optimized.\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!isOptimized)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Let&#39;s attempt to optimized the COM port. Note that the user must</span></div>
<div class="line"><span class="comment">           have premission to update the Window&#39;s Registry for this to work. */</span></div>
<div class="line">        </div>
<div class="line">        errorCode = vncp_comPort_optimize(PORT_NAME);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (errorCode != <a class="code" href="group___v_n___e_r_r_o_r___c_o_d_e.html#ga375de3d5056cfee0551d6b345b67b3ff">VNERR_NO_ERROR</a>)</div>
<div class="line">        {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Error received when trying to optimize the COM port.\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Alright. If we get here, we should have an optimized COM port and can</span></div>
<div class="line"><span class="comment">       perform some timing tests to make sure everything is running as expected. */</span></div>
<div class="line"></div>
<div class="line">    errorCode = <a name="a3"></a><a class="code" href="vn100_8h.html#ac67c964aedc127f46a5b3e61b2269f19" title="Connects to a VectorNav VN-100 device. ">vn100_connect</a>(&amp;vn100, PORT_NAME, BAUDRATE);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Make sure the user has permission to use the COM port. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (errorCode == <a name="a4"></a><a class="code" href="group___v_n___e_r_r_o_r___c_o_d_e.html#gaa801931a63a617e56ee57f282a64107c">VNERR_PERMISSION_DENIED</a>) {</div>
<div class="line"></div>
<div class="line">        printf(<span class="stringliteral">&quot;Current user does not have permission to open the COM port.\n&quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Try running again using &#39;sudo&#39;.\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errorCode != <a class="code" href="group___v_n___e_r_r_o_r___c_o_d_e.html#ga375de3d5056cfee0551d6b345b67b3ff">VNERR_NO_ERROR</a>)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error trying to connect to sensor.\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    errorCode = <a name="a5"></a><a class="code" href="vn100_8h.html#afba3b4da721a15b6a23f74cd3e1293ef" title="Sets the values of the Asynchronous Data Output Type register. ">vn100_setAsynchronousDataOutputType</a>(</div>
<div class="line">        &amp;vn100,</div>
<div class="line">        <a name="a6"></a><a class="code" href="group___a_s_y_n_c___o_u_t_p_u_t_s.html#ga71d02161293ae5591788cb5bb5b17b22">VNASYNC_VNYPR</a>,</div>
<div class="line">        <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (errorCode != <a class="code" href="group___v_n___e_r_r_o_r___c_o_d_e.html#ga375de3d5056cfee0551d6b345b67b3ff">VNERR_NO_ERROR</a>)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error encountered when setting the sensor&#39;s asynchronous data output type.\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    errorCode = <a name="a7"></a><a class="code" href="vn100_8h.html#a02ed08a26d518b2005310eac8ffa20d7" title="Sets the values of the Asynchronous Data Output Frequency register. ">vn100_setAsynchronousDataOutputFrequency</a>(</div>
<div class="line">        &amp;vn100,</div>
<div class="line">        100,</div>
<div class="line">        <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (errorCode != <a class="code" href="group___v_n___e_r_r_o_r___c_o_d_e.html#ga375de3d5056cfee0551d6b345b67b3ff">VNERR_NO_ERROR</a>)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error encountered when setting the sensor&#39;s asynchronous data output frequency.\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* We have our sensor configured to output at 100 Hz. Start the timing tests. */</span></div>
<div class="line"></div>
<div class="line">    vncp_startMsTimer();</div>
<div class="line"></div>
<div class="line">    <a name="a8"></a><a class="code" href="vn100_8h.html#ab4be3bb7fd28f01d1ecdacb6539e4e8a" title="Allows registering a function which will be called whenever a new asynchronous data packet is receive...">vn100_registerAsyncDataReceivedListener</a>(</div>
<div class="line">        &amp;vn100,</div>
<div class="line">        &amp;asyncVn100DataListener);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Pause this thread for 10 seconds. */</span></div>
<div class="line">    vncp_sleepInMs(10000);</div>
<div class="line"></div>
<div class="line">    <a name="a9"></a><a class="code" href="vn100_8h.html#a67c877bd778b2f315ce59f66ed42d099" title="Unregisters an already registered function for recieving notifications of when new asynchronous data ...">vn100_unregisterAsyncDataReceivedListener</a>(</div>
<div class="line">        &amp;vn100,</div>
<div class="line">        &amp;asyncVn100DataListener);</div>
<div class="line"></div>
<div class="line">    <a name="a10"></a><a class="code" href="vn100_8h.html#ac5d243253fabebaa00ea8c8175e14b17" title="Disconnects from the VN-100 device and disposes of any internal resources. ">vn100_disconnect</a>(&amp;vn100);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> asyncVn100DataListener(<span class="keywordtype">void</span>* sender, <a class="code" href="struct_vn_device_composite_data.html" title="Composite structure of the various asynchronous data VectorNav devices are capable of outputting...">VnDeviceCompositeData</a>* data)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">double</span> diff;</div>
<div class="line"></div>
<div class="line">    diff = vncp_stopMsTimer();</div>
<div class="line"></div>
<div class="line">    vncp_startMsTimer();</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* We should be receiving a time difference around 10 ms since we are</span></div>
<div class="line"><span class="comment">       outputting data at 100 Hz. */</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Time Diff: %.2f\n&quot;</span>, diff);</div>
<div class="line">}</div>
<div class="line"></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jun 11 2014 11:34:32 for VectorNav C/C++ Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.4
</small></address>
</body>
</html>
