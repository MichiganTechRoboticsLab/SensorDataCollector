<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>VectorNav C/C++ Library: vn200_windows_async.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">VectorNav C/C++ Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">vn200_windows_async.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>This example shows how to register a callback function with the library which is called whenever new asynchronous data is received from a VN-200 sensor. Since the callback function will be called on a different thread than the user's main thread, some level of thread synchronization techniques may be needed to prevent memory corruption. An alternative to this method may be found in <a class="el" href="vn200_windows_async_easy_8c-example.html">vn200_windows_async.c</a> which removes the need for the user to worry about thread synchronization issues.</p>
<p>In this example, the main user's thread connects to the VN-200 sensor and then registers a callback function. The main user's thread sleeps for 10 seconds and all callbacks printout the received INS solution.</p>
<h1><a class="anchor" id="runningVn200WindowsAsync"></a>
Running the Example</h1>
<ol type="1">
<li>On your Windows machine, open the appropriate project located under the directory <code>&lt;VectorNav C/C++ Library Root&gt;/examples/vn200_windows_async</code>.<ul>
<li>If you are using Visual Studio 2008, open the project file <code>Vn200WindowsAsync.vcproj</code>.</li>
<li>If you are using Visual Studio 2010 or greater, open the project file <code>Vn200WindowsAsync.vcxproj</code>. Note, you may be prompted to upgrade the project file.</li>
</ul>
</li>
<li>Under the project listing in <code>Visual Studio</code>, open the file <code>Source Files/vn200_windows_async.c</code> and change the connection defines <code>PORT_NAME</code> and <code>BAUDRATE</code> to the settings of your VN-200 sensor.</li>
<li>Now, right-click the project and select the option <code>Build</code>. Make sure the project builds correctly and the text <code>Build succeeded</code> appears in the bottom-left of <code>Visual Studio</code>.</li>
<li>With the project built, you can now run the program. However, to pause the console so you can see the program's output, it is recommended that you run the project by pressing <em>Ctrl + F5</em>.</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Windows.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;tchar.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="vectornav_8h.html">vectornav.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Change the connection settings to your configuration. */</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> COM_PORT = <span class="stringliteral">&quot;COM1&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> BAUD_RATE = 115200;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> asyncDataListener(</div>
<div class="line">    <span class="keywordtype">void</span>* sender,</div>
<div class="line">    <a name="_a0"></a><a class="code" href="struct_vn_device_composite_data.html" title="Composite structure of the various asynchronous data VectorNav devices are capable of outputting...">VnDeviceCompositeData</a>* data);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> _tmain(<span class="keywordtype">int</span> argc, _TCHAR* argv[])</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="vn__error_codes_8h.html#a2ab6e10832948454e3977ea34d483765">VN_ERROR_CODE</a> errorCode;</div>
<div class="line">    <a name="_a1"></a><a class="code" href="struct_vn200.html" title="Holds connection information for accessing a VN-200 device. ">Vn200</a> vn200;</div>
<div class="line"></div>
<div class="line">    errorCode = <a name="a2"></a><a class="code" href="vn200_8h.html#a47f3edad147c4d57b8d32693ec98f09b" title="Connects to a VectorNav VN-200 device. ">vn200_connect</a>(</div>
<div class="line">        &amp;vn200,</div>
<div class="line">        COM_PORT,</div>
<div class="line">        BAUD_RATE);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Make sure the user has permission to use the COM port. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (errorCode == <a name="a3"></a><a class="code" href="group___v_n___e_r_r_o_r___c_o_d_e.html#gaa801931a63a617e56ee57f282a64107c">VNERR_PERMISSION_DENIED</a>) {</div>
<div class="line"></div>
<div class="line">        printf(<span class="stringliteral">&quot;Current user does not have permission to open the COM port.\n&quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Try running again using &#39;sudo&#39;.\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errorCode != <a name="a4"></a><a class="code" href="group___v_n___e_r_r_o_r___c_o_d_e.html#ga375de3d5056cfee0551d6b345b67b3ff">VNERR_NO_ERROR</a>)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error encountered when trying to connect to the sensor.\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Configure the VN-200 to output asynchronous data. */</span></div>
<div class="line">    errorCode = <a name="a5"></a><a class="code" href="vn200_8h.html#a515b852cdb507c0bead453c635836895" title="Sets the values of the Asynchronous Data Output Type register. ">vn200_setAsynchronousDataOutputType</a>(</div>
<div class="line">        &amp;vn200,</div>
<div class="line">        <a name="a6"></a><a class="code" href="group___a_s_y_n_c___o_u_t_p_u_t_s.html#ga333fbd888f393e410cec181e8262a136">VNASYNC_VNINS</a>,</div>
<div class="line">        <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Now tell the library which function to call when a new asynchronous</span></div>
<div class="line"><span class="comment">       packet is received. */</span></div>
<div class="line">    errorCode = <a name="a7"></a><a class="code" href="vn200_8h.html#ad7784923f80289c473c05ff1408902b8" title="Allows registering a function which will be called whenever a new asynchronous data packet is receive...">vn200_registerAsyncDataReceivedListener</a>(</div>
<div class="line">        &amp;vn200,</div>
<div class="line">        &amp;asyncDataListener);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Pause the current thread for 10 seconds. Data received asynchronously</span></div>
<div class="line"><span class="comment">       will call the function asyncDataListener on a separate thread. */</span></div>
<div class="line">    Sleep(10000);</div>
<div class="line"></div>
<div class="line">    errorCode = <a name="a8"></a><a class="code" href="vn200_8h.html#aa9e365d4c582436cc10a22e2ec29829e" title="Unregisters an already registered function for recieving notifications of when new asynchronous data ...">vn200_unregisterAsyncDataReceivedListener</a>(</div>
<div class="line">        &amp;vn200,</div>
<div class="line">        &amp;asyncDataListener);</div>
<div class="line">    </div>
<div class="line">    errorCode = <a name="a9"></a><a class="code" href="vn200_8h.html#ae1b3c86c23274c7f1bd385612ee5b1f8" title="Disconnects from the VN-200 device and disposes of any internal resources. ">vn200_disconnect</a>(&amp;vn200);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (errorCode != <a class="code" href="group___v_n___e_r_r_o_r___c_o_d_e.html#ga375de3d5056cfee0551d6b345b67b3ff">VNERR_NO_ERROR</a>)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error encountered when trying to disconnect from the sensor.\n&quot;</span>);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> asyncDataListener(<span class="keywordtype">void</span>* sender, <a class="code" href="struct_vn_device_composite_data.html" title="Composite structure of the various asynchronous data VectorNav devices are capable of outputting...">VnDeviceCompositeData</a>* data)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;INS Solution:\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  YPR.Yaw:                %+#7.2f\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  YPR.Pitch:              %+#7.2f\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  YPR.Roll:               %+#7.2f\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  LLA.Latitude:           %+#7.2f\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  LLA.Longitude:          %+#7.2f\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  LLA.Altitude:           %+#7.2f\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  Velocity.North:         %+#7.2f\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  Velocity.East:          %+#7.2f\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  Velocity.Down:          %+#7.2f\n&quot;</span>,</div>
<div class="line">        data-&gt;<a name="a10"></a><a class="code" href="struct_vn_device_composite_data.html#a89640ce35f52e39f725d558765b1c115">ypr</a>.<a name="a11"></a><a class="code" href="struct_vn_ypr.html#a21cd490f6191f66678f55b4c242a10cf">yaw</a>,</div>
<div class="line">        data-&gt;<a class="code" href="struct_vn_device_composite_data.html#a89640ce35f52e39f725d558765b1c115">ypr</a>.<a name="a12"></a><a class="code" href="struct_vn_ypr.html#a34c057a0378030db67bd6a129f37d938">pitch</a>,</div>
<div class="line">        data-&gt;<a class="code" href="struct_vn_device_composite_data.html#a89640ce35f52e39f725d558765b1c115">ypr</a>.<a name="a13"></a><a class="code" href="struct_vn_ypr.html#a1d3228afa3a1d6773954f40c1e519eb9">roll</a>,</div>
<div class="line">        data-&gt;<a name="a14"></a><a class="code" href="struct_vn_device_composite_data.html#a9710e0993ae6090d1f696b7567798388">latitudeLongitudeAltitude</a>.<a name="a15"></a><a class="code" href="struct_vn_vector3.html#a1d23aed57ae21b2856939bd1b932763f">c0</a>,</div>
<div class="line">        data-&gt;<a class="code" href="struct_vn_device_composite_data.html#a9710e0993ae6090d1f696b7567798388">latitudeLongitudeAltitude</a>.<a name="a16"></a><a class="code" href="struct_vn_vector3.html#a8a289ed190008419ee49288535be093d">c1</a>,</div>
<div class="line">        data-&gt;<a class="code" href="struct_vn_device_composite_data.html#a9710e0993ae6090d1f696b7567798388">latitudeLongitudeAltitude</a>.<a name="a17"></a><a class="code" href="struct_vn_vector3.html#a3d7054db04feaba66495dccf1a8ce86c">c2</a>,</div>
<div class="line">        data-&gt;<a name="a18"></a><a class="code" href="struct_vn_device_composite_data.html#ade984f384dd7a97026f7f7596fda612d">velocity</a>.<a class="code" href="struct_vn_vector3.html#a1d23aed57ae21b2856939bd1b932763f">c0</a>,</div>
<div class="line">        data-&gt;<a class="code" href="struct_vn_device_composite_data.html#ade984f384dd7a97026f7f7596fda612d">velocity</a>.<a class="code" href="struct_vn_vector3.html#a8a289ed190008419ee49288535be093d">c1</a>,</div>
<div class="line">        data-&gt;<a class="code" href="struct_vn_device_composite_data.html#ade984f384dd7a97026f7f7596fda612d">velocity</a>.<a class="code" href="struct_vn_vector3.html#a3d7054db04feaba66495dccf1a8ce86c">c2</a>);</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;\n\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jun 11 2014 11:34:32 for VectorNav C/C++ Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.4
</small></address>
</body>
</html>
